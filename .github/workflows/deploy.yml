name: –í—ñ–¥–¥–∞–ª–µ–Ω–∏–π –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç

on:
  workflow_dispatch:
    inputs:
      environment:
        description: '–°–µ—Ä–µ–¥–æ–≤–∏—â–µ –¥–ª—è –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—É'
        required: true
        default: 'production'
        type: choice
        options:
        - production
        - staging

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: –î–µ–ø–ª–æ–π–º–µ–Ω—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    
    steps:
    - name: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ —ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.PRIVATE_KEY }}
        port: ${{ secrets.PORT || 22 }}
        script: |
          echo "üöÄ –ü–æ—á–∞—Ç–æ–∫ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—É..."
          
          # –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É httpdocs
          cd httpdocs
          
          # –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ç–æ—á–Ω—É –≥—ñ–ª–∫—É
          echo "üìÇ –ü–æ—Ç–æ—á–Ω–∞ –≥—ñ–ª–∫–∞:"
          git branch --show-current
          
          # –ü–æ–∫–∞–∑—É—î–º–æ —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º
          echo "üìä –°—Ç–∞—Ç—É—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º:"
          git status --porcelain
          
          # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –ª–æ–∫–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏ —ñ –ø—É—à–∏–º–æ —ó—Ö –ø–µ—Ä–µ–¥ pull
          if [ -n "$(git status --porcelain)" ]; then
            echo "‚ö†Ô∏è –ó–Ω–∞–π–¥–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏ (–º–æ–∂–ª–∏–≤–æ –∞–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è WordPress)"
            echo "üíæ –î–æ–¥–∞—î–º–æ –∑–º—ñ–Ω–∏ –¥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é..."
            git add .
            git commit -m "Auto-commit: –ª–æ–∫–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–æ–º $(date +'%Y-%m-%d %H:%M:%S')"
            echo "‚¨ÜÔ∏è –ü—É—à–∏–º–æ –∑–º—ñ–Ω–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π..."
            git push origin main
          else
            echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω –Ω–µ–º–∞—î"
          fi
          
          # –í–∏–∫–æ–Ω—É—î–º–æ git pull
          echo "‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –∑–º—ñ–Ω..."
          git pull origin main
          
          # –ü–æ–∫–∞–∑—É—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π –∫–æ–º—ñ—Ç
          echo "‚úÖ –û—Å—Ç–∞–Ω–Ω—ñ–π –∫–æ–º—ñ—Ç:"
          git log -1 --oneline
          
          echo "üéâ –î–µ–ø–ª–æ–π–º–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!"
          
    - name: –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      if: always()
      run: |
        if [ "${{ job.status }}" == "success" ]; then
          echo "‚úÖ –î–µ–ø–ª–æ–π–º–µ–Ω—Ç —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
        else
          echo "‚ùå –î–µ–ø–ª–æ–π–º–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–≤—Å—è –∑ –ø–æ–º–∏–ª–∫–æ—é!"
        fi 